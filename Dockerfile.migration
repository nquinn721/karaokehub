# Dockerfile for running migrations
FROM node:20-alpine

WORKDIR /app

# Copy package files
COPY package*.json ./

# Install production dependencies
RUN npm ci --only=production

# Copy source code and migration files
COPY src/ ./src/
COPY run-migrations.js ./
COPY tsconfig*.json ./

# Install TypeScript and build
RUN npm install -g typescript
RUN npm install -D @types/node
RUN npm run build

# Set the entrypoint
ENTRYPOINT ["node"]